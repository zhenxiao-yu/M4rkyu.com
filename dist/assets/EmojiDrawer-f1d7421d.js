import{v as u}from"./index-b074c409.js";import{S as j,a9 as h,e as D,Q as v,a2 as x}from"./ParticlesComponent-26f4581c.js";import"./index-ca4d20e1.js";function S(d){const{context:o,particle:e,radius:n,opacity:i}=d,t=e.emojiData,r=2,c=n*r,m=o.globalAlpha;t&&(o.globalAlpha=i,o.drawImage(t,-n,-n,c,c),o.globalAlpha=m)}const g='"Twemoji Mozilla", Apple Color Emoji, "Segoe UI Emoji", "Noto Color Emoji", "EmojiOne Color"';class A{constructor(){this._emojiShapeDict=new Map}destroy(){for(const[o,e]of this._emojiShapeDict)e instanceof ImageBitmap&&(e==null||e.close(),this._emojiShapeDict.delete(o))}draw(o){S(o)}async init(o){const e=o.actualOptions;if(!u.find(t=>j(t,e.particles.shape.type)))return;const n=[h(g)],i=u.map(t=>e.particles.shape.options[t]).find(t=>!!t);i&&D(i,t=>{t.font&&n.push(h(t.font))}),await Promise.all(n)}particleDestroy(o){delete o.emojiData}particleInit(o,e){const i=e.shapeData;if(!(i!=null&&i.value))return;const t=v(i.value,e.randomIndexData),r=i.font??g;if(!t)return;const c=`${t}_${r}`,m=this._emojiShapeDict.get(c);if(m){e.emojiData=m;return}const p=x(e.size.value)*2;let f;const l=x(e.size.value);if(typeof OffscreenCanvas<"u"){const s=new OffscreenCanvas(p,p),a=s.getContext("2d");if(!a)return;a.font=`400 ${l*2}px ${r}`,a.textBaseline="middle",a.textAlign="center",a.fillText(t,l,l),f=s.transferToImageBitmap()}else{const s=document.createElement("canvas");s.width=p,s.height=p;const a=s.getContext("2d");if(!a)return;a.font=`400 ${l*2}px ${r}`,a.textBaseline="middle",a.textAlign="center",a.fillText(t,l,l),f=s}this._emojiShapeDict.set(c,f),e.emojiData=f}}export{A as EmojiDrawer};
